

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>autobahn.websocket.useragent &mdash; Autobahn 0.8.5 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../../../',
        VERSION:'0.8.5',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Autobahn 0.8.5 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="icon icon-home"> Autobahn</a>
        <form class="wy-form" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../websockettoc.html">WebSocket</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../websocketintro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../websocketbase.html">WebSocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../websocketclient.html">WebSocket Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../websocketserver.html">WebSocket Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../websocketcompress.html">WebSocket Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../websocketaux.html">WebSocket Auxiliary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../twistedintegration.html">Twisted Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../wamp1toc.html">WAMP v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp1base.html">Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp1client.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp1server.html">Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../wamp2.html">WAMP v2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2.html#sessions">Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2.html#callers">Callers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2.html#callees">Callees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2.html#subscribers">Subscribers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2.html#publishers">Publishers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2.html#decorators">Decorators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../wamp2all.html">WAMP v2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2all.html#interfaces">Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2all.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2all.html#router">Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wamp2all.html#protocol">Protocol</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Autobahn</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../../../index.html">Docs</a> &raquo;</li>
  <li><a href="">autobahn.websocket.useragent</a></li>
  
</ul>
<hr/>

          
  <h1>Source code for autobahn.websocket.useragent</h1><div class="highlight"><pre>
<span class="c">###############################################################################</span>
<span class="c">##</span>
<span class="c">##  Copyright (C) 2011-2013 Tavendo GmbH</span>
<span class="c">##</span>
<span class="c">##  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c">##  you may not use this file except in compliance with the License.</span>
<span class="c">##  You may obtain a copy of the License at</span>
<span class="c">##</span>
<span class="c">##      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">##</span>
<span class="c">##  Unless required by applicable law or agreed to in writing, software</span>
<span class="c">##  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c">##  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c">##  See the License for the specific language governing permissions and</span>
<span class="c">##  limitations under the License.</span>
<span class="c">##</span>
<span class="c">###############################################################################</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;lookupWsSupport&quot;</span><span class="p">,)</span>


<span class="kn">import</span> <span class="nn">re</span>

<span class="n">UA_FIREFOX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*Firefox/(\d*).*&quot;</span><span class="p">)</span>
<span class="n">UA_CHROME</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*Chrome/(\d*).*&quot;</span><span class="p">)</span>
<span class="n">UA_CHROMEFRAME</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*chromeframe/(\d*).*&quot;</span><span class="p">)</span>
<span class="n">UA_WEBKIT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*AppleWebKit/([0-9+\.]*)\w*.*&quot;</span><span class="p">)</span>
<span class="n">UA_WEBOS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*webos/([0-9+\.]*)\w*.*&quot;</span><span class="p">)</span>
<span class="n">UA_HPWEBOS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*hpwOS/([0-9+\.]*)\w*.*&quot;</span><span class="p">)</span>



<span class="c"># Chrome =============================================================</span>

<span class="c"># Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11</span>


<span class="c"># Chrome Frame =======================================================</span>

<span class="c"># IE6 on Windows with Chrome Frame</span>
<span class="c"># Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; chromeframe/11.0.660.0)</span>


<span class="c"># Firefox ============================================================</span>

<span class="c"># Windows 7 64 Bit</span>
<span class="c"># Mozilla/5.0 (Windows NT 6.1; WOW64; rv:12.0a2) Gecko/20120227 Firefox/12.0a2</span>


<span class="c"># Android ============================================================</span>

<span class="c"># Firefox Mobile</span>
<span class="c"># Mozilla/5.0 (Android; Linux armv7l; rv:10.0.2) Gecko/20120215 Firefox/10.0.2 Fennec/10.0.2</span>

<span class="c"># Chrome for Android (on ICS)</span>
<span class="c"># Mozilla/5.0 (Linux; U; Android-4.0.3; en-us; Galaxy Nexus Build/IML74K) AppleWebKit/535.7 (KHTML, like Gecko) CrMo/16.0.912.75 Mobile Safari/535.7</span>

<span class="c"># Android builtin browser</span>

<span class="c"># Samsung Galaxy Tab 1</span>
<span class="c"># Mozilla/5.0 (Linux; U; Android 2.2; de-de; GT-P1000 Build/FROYO) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1</span>

<span class="c"># Samsung Galaxy S</span>
<span class="c"># Mozilla/5.0 (Linux; U; Android 2.3.3; de-de; GT-I9000 Build/GINGERBREAD) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1</span>

<span class="c"># Samsung Galaxy Note</span>
<span class="c"># Mozilla/5.0 (Linux; U; Android 2.3.6; de-de; GT-N7000 Build/GINGERBREAD) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1</span>

<span class="c"># Samsung Galaxy ACE (no Flash since ARM)</span>
<span class="c"># Mozilla/5.0 (Linux; U; Android 2.2.1; de-de; GT-S5830 Build/FROYO) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1</span>


<span class="c"># WebOS ==============================================================</span>

<span class="c"># HP Touchpad</span>
<span class="c"># Mozilla/5.0 (hp-tablet; Linux; hpwOS/3.0.5; U; en-US) AppleWebKit/534.6 (KHTML, like Gecko) wOSBrowser/234.83 Safari/534.6 TouchPad/1.0</span>
<span class="c"># =&gt; Qt-WebKit, Hixie-76, Flash</span>


<span class="c"># Safari =============================================================</span>

<span class="c"># iPod Touch, iOS 4.2.1</span>
<span class="c"># Mozilla/5.0 (iPod; U; CPU iPhone OS 4_2_1 like Mac OS X; de-de) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5</span>
<span class="c"># =&gt; Hixie-76</span>

<span class="c"># MacBook Pro, OSX 10.5.8, Safari 5.0.6</span>
<span class="c"># Mozilla/5.0 (Macintosh; Intel Mac OS X 10_5_8) AppleWebKit/534.50.2 (KHTML, like Gecko) Version/5.0.6 Safari/533.22.3</span>
<span class="c"># =&gt; Hixie-76</span>

<span class="c"># RFC6455</span>
<span class="c"># Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534+ (KHTML, like Gecko) Version/5.1.2 Safari/534.52.7</span>
<span class="c"># Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.24+ (KHTML, like Gecko) Version/5.1.3 Safari/534.53.10</span>

<span class="c"># Hixie-76</span>
<span class="c"># Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/534.53.11 (KHTML, like Gecko) Version/5.1.3 Safari/534.53.10</span>

<span class="c"># Hixie-76</span>
<span class="c"># Mozilla/5.0 (Macintosh; Intel Mac OS X 10_5_8) AppleWebKit/534.50.2 (KHTML, like Gecko) Version/5.0.6 Safari/533.22.3</span>


<span class="c"># Opera ==============================================================</span>

<span class="c"># Windows 7 32-Bit</span>
<span class="c"># Opera/9.80 (Windows NT 6.1; U; de) Presto/2.10.229 Version/11.61</span>

<span class="c"># Windows 7 64-Bit</span>
<span class="c"># Opera/9.80 (Windows NT 6.1; WOW64; U; de) Presto/2.10.229 Version/11.62</span>

<span class="c"># Samsung Galaxy S</span>
<span class="c"># Opera/9.80 (Android 2.3.3; Linux; Opera Mobi/ADR-1202231246; U; de) Presto/2.10.254 Version/12.00</span>

<span class="c"># Samsung Galaxy Tab 1</span>
<span class="c"># Opera/9.80 (Android 2.2; Linux; Opera Tablet/ADR-1203051631; U; de) Presto/2.10.254 Version/12.00</span>

<span class="c"># Samsung Galaxy ACE:</span>
<span class="c"># Opera/9.80 (Android 2.2.1; Linux; Opera Mobi/ADR-1203051631; U; de) Presto/2.10.254 Version/12.00</span>

<span class="c"># Nokia N8, Symbian S60 5th Ed., S60 Bell</span>
<span class="c"># Opera/9.80 (S60; SymbOS; Opera Mobi/SYB-1111151949; U; de) Presto/2.9.201 Version/11.50</span>


<span class="k">def</span> <span class="nf">_lookupWsSupport</span><span class="p">(</span><span class="n">ua</span><span class="p">):</span>
   <span class="c">## Internet Explorer</span>
   <span class="c">##</span>
   <span class="c">## FIXME: handle Windows Phone</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;MSIE&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c"># IE10 has native support</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;MSIE 10&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c"># native Hybi-10+</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

      <span class="c"># first, check for Google Chrome Frame</span>
      <span class="c"># http://www.chromium.org/developers/how-tos/chrome-frame-getting-started/understanding-chrome-frame-user-agent</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;chromeframe&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

         <span class="n">r</span> <span class="o">=</span> <span class="n">UA_CHROMEFRAME</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
         <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
               <span class="c"># native Hybi-10+</span>
               <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
         <span class="k">except</span><span class="p">:</span>
            <span class="c"># detection problem</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

      <span class="c"># Flash fallback</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;MSIE 8&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;MSIE 9&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

      <span class="c"># unsupported</span>
      <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


   <span class="c">## iOS</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;iPhone&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;iPad&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;iPod&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c">## native Hixie76 (as of March 2012), no Flash, no alternative browsers</span>
      <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


   <span class="c">## Android</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Android&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

      <span class="c">## Firefox Mobile</span>
      <span class="c">##</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Firefox&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c"># Hybi-10+ for FF Mobile 8+</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

      <span class="c">## Opera Mobile</span>
      <span class="c">##</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Opera&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c"># Hixie76 for Opera 11+</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

      <span class="c">## Chrome for Android</span>
      <span class="c">##</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;CrMo&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c"># http://code.google.com/chrome/mobile/docs/faq.html</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

      <span class="c">## Android builtin Browser (ooold WebKit)</span>
      <span class="c">##</span>
      <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;AppleWebKit&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

         <span class="c"># Though we return WS = True, and Flash = True here, when the device has no actual Flash support, that</span>
         <span class="c"># will get later detected in JS. This applies to i.e. ARMv6 devices like Samsung Galaxy ACE</span>

         <span class="c"># builtin browser, only works via Flash</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

      <span class="c"># detection problem</span>
      <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


   <span class="c">## webOS</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;hpwOS&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;webos&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;hpwOS&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vv</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UA_HPWEBOS</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
               <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
         <span class="k">elif</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;webos&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vv</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">UA_WEBOS</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
               <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
         <span class="c"># detection problem</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c"># unsupported</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


   <span class="c">## Opera</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Opera&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c"># Opera 11+ has Hixie76 (needs to be manually activated though)</span>
      <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


   <span class="c">## Firefox</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Firefox&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">r</span> <span class="o">=</span> <span class="n">UA_FIREFOX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span>
         <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="c"># native Hybi-10+</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
         <span class="k">elif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c"># works with Flash bridge</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="c"># unsupported</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
         <span class="c"># detection problem</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


   <span class="c">## Safari</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Safari&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Chrome&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

      <span class="c"># rely on at least Hixie76</span>
      <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


   <span class="c">## Chrome</span>
   <span class="c">##</span>
   <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Chrome&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">r</span> <span class="o">=</span> <span class="n">UA_CHROME</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span>
         <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="c"># native Hybi-10+</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
         <span class="k">elif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c"># works with Flash bridge</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="c"># unsupported</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
         <span class="c"># detection problem</span>
         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


   <span class="c"># detection problem</span>
   <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


<span class="n">UA_DETECT_WS_SUPPORT_DB</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="lookupWsSupport"><a class="viewcode-back" href="../../../websocketaux.html#autobahn.websocket.useragent.lookupWsSupport">[docs]</a><span class="k">def</span> <span class="nf">lookupWsSupport</span><span class="p">(</span><span class="n">ua</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Lookup if browser supports WebSocket (Hixie76, Hybi10+, RFC6455) natively,</span>
<span class="sd">   and if not, whether the `web-socket-js &lt;https://github.com/gimite/web-socket-js&gt;`_</span>
<span class="sd">   Flash bridge works to polyfill that.</span>

<span class="sd">   Returns a tuple of booleans `(ws_supported, needs_flash, detected)` where</span>

<span class="sd">      * `ws_supported`: WebSocket is supported</span>
<span class="sd">      * `needs_flash`: Flash Bridge is needed for support</span>
<span class="sd">      * `detected` the code has explicitly mapped the support/nosupport</span>

<span class="sd">   :param ua: The browser user agent string as sent in the HTTP header, e.g. provided as `flask.request.user_agent.string` in Flask.</span>
<span class="sd">   :type ua: str</span>

<span class="sd">   :returns: tuple -- A tuple `(ws_supported, needs_flash, detected)`.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">ws</span> <span class="o">=</span> <span class="n">_lookupWsSupport</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">UA_DETECT_WS_SUPPORT_DB</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">ua</span><span class="p">):</span>
         <span class="n">UA_DETECT_WS_SUPPORT_DB</span><span class="p">[</span><span class="n">ua</span><span class="p">]</span> <span class="o">=</span> <span class="n">ws</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">ws</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
         <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;UNDETECTED&quot;</span>
      <span class="k">elif</span> <span class="n">ws</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
         <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;SUPPORTED&quot;</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="n">ws</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
         <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;UNSUPPORTED&quot;</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;ERROR&quot;</span>

      <span class="k">print</span><span class="p">(</span><span class="s">&quot;DETECT_WS_SUPPORT: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ua</span><span class="p">,</span> <span class="n">ws</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ws</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">msg</span><span class="p">))</span>

   <span class="k">return</span> <span class="n">ws</span></div>
</pre></div>

          <footer>
  

  <hr/>

  <p>
      &copy; Copyright 2011-2014 Tavendo GmbH.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>